<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Backdoor - Tag - appsec &amp; stuff</title><link>https://appsec.space/tags/backdoor/</link><description>Backdoor - Tag - appsec &amp; stuff</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sat, 30 Mar 2024 19:49:24 +0100</lastBuildDate><atom:link href="https://appsec.space/tags/backdoor/" rel="self" type="application/rss+xml"/><item><title>The xz backdoor from a Security Engineer persepective</title><link>https://appsec.space/posts/xz-backdoor/</link><pubDate>Sat, 30 Mar 2024 19:49:24 +0100</pubDate><author><name>himazawa</name></author><guid>https://appsec.space/posts/xz-backdoor/</guid><description><![CDATA[<div class="featured-image">
                <img src="/posts/xz-backdoor/xz.png" referrerpolicy="no-referrer">
            </div><p>As you probably already heard, the <code>xz</code> package got compromised.</p>
<p>The package was used as entrypoint to inject malicious code in sshd, altering the authentication flow. This forged vulnerability is now known as CVE-2024-3094.</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">The situation is still ongoing, more details will emerge in the near future and I will upgrade this post accordingly.</div>
        </div>
    </div>
<p>This is probably a full fledge operation due to it&rsquo;s methodology and duration but I&rsquo;m not the right guy to talk about OpSec and Threat Actors attributions.
As soon as I will find a complete analysis on that matter I will link it.</p>
<p>The situation doesn&rsquo;t look too good so I&rsquo;m trying to write this blogpost as a summary. I don&rsquo;t want to address the technical aspect of the compromission but I want to look at the issue from the perspective of a Security Engineer, summarizing what went wrong and trying to find a remediation.</p>
<h2 id="timeline" class="headerLink">
    <a href="#timeline" class="header-mark"></a>1 Timeline</h2><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Check the Resources section for a link to an article with a detailed timeline</div>
        </div>
    </div>
<ul>
<li><strong>2023</strong>:
<ul>
<li>A new maintainer shows up in the <code>xz</code> project.</li>
</ul>
</li>
<li><strong>29 Mar 2024</strong>:
<ul>
<li>
<p>Andres Freund sent an email to the oss-security security regarding a backdoor in <code>xz/liblzma</code>.
He was optimizing his infrastructure and found that ssh was  suspiciously slow. Some debug later he found the issue was likely caused by the backdoor. The initial analysis was performed with the help of Florian Weimer.</p>
</li>
<li>
<p>The post was sent to the oss-security mailing list</p>
</li>
<li>
<p>Impacted distros are starting to ship patches to downgrade the xz version (more on that later)</p>
</li>
</ul>
</li>
<li><strong>30 Mar 2024</strong>:
<ul>
<li>GitHub blocked access to the repostiory and blocked the account of both the xz maintainers</li>
</ul>
</li>
</ul>
<h2 id="impacted-components" class="headerLink">
    <a href="#impacted-components" class="header-mark"></a>2 Impacted components</h2><p>The extent of this breach is still unkown, but here is a (partial) list of components shipping the known malicious version of <code>xz</code>:</p>
<p>Distributions:</p>
<ul>
<li>Arch</li>
<li>Gentoo</li>
<li>Manjaro Testing</li>
<li>Parabola</li>
<li>NixOS Unstable</li>
<li>Slackware</li>
<li>SUSE Thumbleweed</li>
<li>Kali Linux</li>
</ul>
<p>The backdoored package is also contained in the following package managers:</p>
<ul>
<li>Homebrew</li>
<li>MacPorts</li>
<li>pkgsrc</li>
</ul>
<h2 id="considerations" class="headerLink">
    <a href="#considerations" class="header-mark"></a>3 Considerations</h2><h3 id="the-github-behavior" class="headerLink">
    <a href="#the-github-behavior" class="header-mark"></a>3.1 The GitHub Behavior</h3><p>The reasons behind the <code>xz</code> repositories lockdown are still a mistery to me, especially knowing that with the source code available additional anaysis on the backdoor could be performed.</p>
<p>Blocking access to the source code is something that will delay further results, that is honestly really bad for time-critical situation like this one.</p>
<h3 id="the-downgrades" class="headerLink">
    <a href="#the-downgrades" class="header-mark"></a>3.2 The downgrades</h3><p>The patch strategy for basically everyone was to force a downgrade from the <code>5.6.0</code>-<code>5.6.1</code> to another version.<br>
Some (homebrew, for example), forced the downgrade to 5.4.6.</p>
<p>This looks interesting because for sure we know there is a backdoor on that (<code>5.6.0</code>-<code>5.6.1</code>) versions, but we also know that the attacker has been working on the repository for over two years.</p>
<p>The <code>5.4.6</code> version is also builded by the attacker and honestly wouldn&rsquo;t trust it much.
Again, thanks GitHub for locking the access to the source code.</p>
<h2 id="how-to-prevent-this-issue" class="headerLink">
    <a href="#how-to-prevent-this-issue" class="header-mark"></a>4 How to prevent this issue?</h2><p>As I said at the beginning of the post, I don&rsquo;t want to go too deep into the technical analysis of the backdoor, for two main reasons: with the sourcecode locked and only <a href="https://github.com/xz-mirror/xz" target="_blank" rel="noopener noreferrer">an archive available</a> the informations are incomplete and I really don&rsquo;t want to reverse the <code>xz</code> binary.
Also, and this is the more important reasons, people more knowledgeable than me on Threat Actors behaviors are already on it.
I will just link their posts once are ready, so make sure to check the Resources section below.</p>
<p>One thing I can do here is showing the point of view of a Security Engineer on the issue, how I would mitigate the problem and what steps went wrong.</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">TL;DR: there isn&rsquo;t an actual solution</div>
        </div>
    </div>
<h3 id="trust-issues" class="headerLink">
    <a href="#trust-issues" class="header-mark"></a>4.1 Trust issues</h3><p><figure><a class="lightgallery" href="https://imgs.xkcd.com/comics/dependency_2x.png" title="https://imgs.xkcd.com/comics/dependency_2x.png" data-thumbnail="https://imgs.xkcd.com/comics/dependency_2x.png">
        <img
            
            loading="lazy"
            src="https://imgs.xkcd.com/comics/dependency_2x.png"
            srcset="https://imgs.xkcd.com/comics/dependency_2x.png, https://imgs.xkcd.com/comics/dependency_2x.png 1.5x, https://imgs.xkcd.com/comics/dependency_2x.png 2x"
            sizes="auto"
            alt="https://imgs.xkcd.com/comics/dependency_2x.png">
    </a></figure></p>
<p><code>xz</code> is a software mainteined (up until 2023) by 1 single guy. Later another maintainer joined but unfortunately for us, it was the same guy pushing the backdoor to upstream.
This crashes against the fact that <code>xz</code> is an incredibly popular package available in a lot of distributions and being a dependency of many softwares.</p>
<p>This was likely seen by the attacker as a gold mine since it was easy to get the role of maintainer of the project and push the malicious code.</p>
<p>Since you are using a thirdy-part source for your supply chain, you have to trust someone at one point or another.
When talking about supply chain security the reccomendations are always the same: pin the hashes and use signature verification. This will work as long as you have scenarios like a malicious attacker compromising the dependency CICD and pushing a malicious build, account compromissions etc.</p>
<p>But what can you do if all of a sudden, trusted maintainers goes rogue?</p>
<p>As a standard user, unless you want (and are able to) code review every single commit from every single piece of software your OS interact with: pretty much nothing.</p>
<p>On the other hand, developers and repository owners should really increase controls on their supply chain and include strict metrics to exclude high risk packages.
One of the biggest gimmicks of Open Source security is people beliving that since the source code is available the code magically became safe.</p>
<p>One critical factor often overlooked is the assumption that having access to the source code automatically translates into a larger pool of eyes scrutinizing it for vulnerabilities.</p>
<p>The effectiveness of this review process depends on the level of community engagement and the expertise of those inspecting the code, and usually is not much at all. Many projects receive minimal attention from developers, with only a handful of individuals actively contributing or reviewing code changes. As a result, vulnerabilities (intentional or not) may go unnoticed for extended periods, posing significant security risks to users.</p>
<p>Every time a discussion like that appears I always remember the <a href="https://blog.infosectcbr.com.au/2018/11/pitfalls-using-strcat.html" target="_blank" rel="noopener noreferrer">InfosectCBR&rsquo;s &ldquo;Month of Kali&rdquo;</a> where <a href="https://twitter.com/silviocesare" target="_blank" rel="noopener noreferrer">Silvio Cesare</a> spent a month popping vulnerabilities on Kali Linux software.</p>
<p>But which factors could contribute on minimizing the risks?</p>
<h3 id="github-stats" class="headerLink">
    <a href="#github-stats" class="header-mark"></a>4.2 GitHub Stats</h3><p>Just to be clear from the beginning: No, you can&rsquo;t trust this kind of metrics.</p>
<p>There is an hidden market of buying and selling GitHub stats like stars, forks etc.
You can read a nice article here: <a href="https://dagster.io/blog/fake-stars" target="_blank" rel="noopener noreferrer">https://dagster.io/blog/fake-stars</a></p>
<h3 id="community-engagement" class="headerLink">
    <a href="#community-engagement" class="header-mark"></a>4.3 Community Engagement</h3><p>Evaluate the size and engagement of the community surrounding the project.</p>
<p>A large and active community can provide additional eyes for reviewing code, reporting bugs, and addressing security issues promptly. <code>xz/liblzma</code> had litterally 2 maintainers and one was the malicious actor.</p>
<h3 id="funding-and-support" class="headerLink">
    <a href="#funding-and-support" class="header-mark"></a>4.4 Funding and Support</h3><p>Consider whether the project receives financial support or sponsorship from reputable organizations. Projects with dedicated funding tend to have more resources available for security audits and ongoing maintenance.
And also are less likely to be completely abandoned.</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Remember: you want to rely on that dependency for the whole week, not only during the maintainer&rsquo;s freetime, projects with a nice financial support will likely be full-time jobs and not just hobbies.</div>
        </div>
    </div>
<h3 id="sdlc" class="headerLink">
    <a href="#sdlc" class="header-mark"></a>4.5 SDLC</h3><p>A good portion of the evaluation should also focus on the SDLC to e ensure security (and quality in general) gates are correcly implemented, approvals on PRs are mandatory and there are healthy practices in place to prevent one single contributor to push malicious code without approval.</p>
<p>Also take in considerations that we are humans, and we make errors. Passing a code review doesn&rsquo;t mean the code is safe, as I said before: there is no real solution, just ways to decrease the probablity for the bad stuff to happen.</p>
<h3 id="enterprise-vs-individual" class="headerLink">
    <a href="#enterprise-vs-individual" class="header-mark"></a>4.6 Enterprise vs Individual</h3><p>This is a controversial topic because there are projects that are maintained by individuals that are well structured but usually relying on (large) enterprise projects will ensure their SDLC best practices are followed, money are keeping the project alive, and a big company is less likely to go all in and backdoor their project on purpose. Again, this just increase the probablity, don&rsquo;t take it for granted ;)</p>
<h2 id="resources" class="headerLink">
    <a href="#resources" class="header-mark"></a>5 Resources</h2><ul>
<li>OSS-Security List: <a href="https://www.openwall.com/lists/oss-security/2024/03/29/4" target="_blank" rel="noopener noreferrer">https://www.openwall.com/lists/oss-security/2024/03/29/4</a></li>
<li>Comprehensive timeline: <a href="https://boehs.org/node/everything-i-know-about-the-xz-backdoor" target="_blank" rel="noopener noreferrer">https://boehs.org/node/everything-i-know-about-the-xz-backdoor</a></li>
<li>Compromise link roundup: <a href="https://shellsharks.com/xz-compromise-link-roundup#title" target="_blank" rel="noopener noreferrer">https://shellsharks.com/xz-compromise-link-roundup#title</a></li>
<li>Obfuscatio Analysis: <a href="https://gynvael.coldwind.pl/?lang=en&amp;id=782" target="_blank" rel="noopener noreferrer">https://gynvael.coldwind.pl/?lang=en&id=782</a></li>
</ul>]]></description></item></channel></rss>